<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LightningWasm</title>
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/ico" href="favicon.ico" />
    <link href="LightningWasm.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
   <!--     <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text">Welcome to IBLightning!</div>
    -->
        <div style="position:absolute; top:30vh; width:100%; text-align:center">
        <img src="/mainlogo.png" alt="IBLightning" width="384">
        
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>
    <script>
        // Simple Web Audio API piano note player
        window.playPianoNote = function(note) {
            const ctx = window._pianoAudioCtx || (window._pianoAudioCtx = new (window.AudioContext || window.webkitAudioContext)());
            const now = ctx.currentTime;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'sine';
            osc.frequency.value = getFrequency(note);
            gain.gain.value = 0.2;
            osc.connect(gain).connect(ctx.destination);
            osc.start(now);
            osc.stop(now + 0.4);
        };
        // Map note names to frequencies (C4 = 261.63 Hz)
        function getFrequency(note) {
            const notes = {
                'C': 261.63,
                'C#': 277.18,
                'D': 293.66,
                'D#': 311.13,
                'E': 329.63,
                'F': 349.23,
                'F#': 369.99,
                'G': 392.00,
                'G#': 415.30,
                'A': 440.00,
                'A#': 466.16,
                'B': 493.88,
                'C2': 523.25
            };
            return notes[note] || 261.63;
        }

        // Keyboard mapping for the piano
        const keyToNote = {
            'a': 'C', 'w': 'C#', 's': 'D', 'e': 'D#', 'd': 'E', 'f': 'F', 't': 'F#',
            'g': 'G', 'y': 'G#', 'h': 'A', 'u': 'A#', 'j': 'B', 'k': 'C2'
        };

        window.pianoWireUpKeys = function(dotNetRef) {
            if (window._pianoKeyHandler) return; // Only wire up once
            window._pianoKeyHandler = function(e) {
                const note = keyToNote[e.key];
                if (note) {
                    window.playPianoNote(note);
                    if (dotNetRef) {
                        dotNetRef.invokeMethodAsync('SetPressedFromJs', note);
                        setTimeout(() => dotNetRef.invokeMethodAsync('SetPressedFromJs', null), 120);
                    }
                    e.preventDefault();
                }
            };
            window.addEventListener('keydown', window._pianoKeyHandler);
        };
        window.pianoUnwireKeys = function() {
            if (window._pianoKeyHandler) {
                window.removeEventListener('keydown', window._pianoKeyHandler);
                window._pianoKeyHandler = null;
            }
        };
    </script>
    <script src="_framework/blazor.webassembly.js"></script>
</body>

</html>
